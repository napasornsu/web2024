<!DOCTYPE html>
<html lang="en">
<head>
  <title>work 1: แบบทดสอบ ม.1</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <style>
    body {
      background-color: #f5f5f5;
    }
    .container-fluid {
      border-bottom: 5px solid #ffffff;
    }
    #btnStart {
      font-size: 1.5rem;
      padding: 10px 30px;
    }
    #quizBox, #answerBox {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    .form-check-label {
      font-size: 1.1rem;
    }
    #btnCheckAnswer {
      font-size: 1.2rem;
      background-color: #007bff;
      border: none;
    }
    #btnCheckAnswer:hover {
      background-color: #0056b3;
    }
    #btnRetry {
      font-size: 1.2rem;
      padding: 10px 30px;
    }
    #scoreDisplay {
      font-size: 1.2rem;
    }
  </style>
</head>

<body>
<!-- คะแนนที่มุมขวาบน -->
<div id="scoreDisplay" class="position-fixed mt-2 me-2 top-0 end-0 bg-light text-dark p-3 rounded shadow-sm d-none">
  คะแนน: 0
</div>

<!-- ส่วนนี้เป็น Header ของหน้าเว็บ -->
<div class="container-fluid p-5 bg-primary text-white text-center">
  <h1>แบบทดสอบ เข้าม.1</h1>
</div>
  
<!-- ปุ่มเริ่มทำแบบทดสอบ -->
<div class="container mt-5">
  <div class="row justify-content-center" id="startBox">
    <button class="btn btn-primary" id="btnStart">เริ่มทำแบบทดสอบ</button>
  </div>

  <!-- ส่วนแสดงคำถาม -->
  <div class="row mt-5" id="quizBox" style="display:none;">
    <div id="quizListBox"></div>
    <div class="text-center mt-4">
      <button class="btn btn-primary" id="btnCheckAnswer">ตรวจคำตอบ</button>
    </div>
  </div>

  <!-- ส่วนเฉลย -->
  <div class="row mt-5" id="answerBox" style="display:none;">
    <h3 class="text-center mb-4">เฉลยคำตอบ</h3>
    <div id="answerContent"></div>
    <div class="text-center mt-4">
      <button class="btn btn-secondary" id="btnRetry">กลับไปที่หน้าแบบทดสอบ</button>
    </div>
  </div>
</div>

<script>
  $(function(){
    let score = 0;

    $("#btnStart").click(function(){
      $("#startBox").hide();
      $("#quizBox").show();
      displayQuizList();
    });

    $("#btnCheckAnswer").click(function(){
      if (!areAllQuestionsAnswered()) {
        alert("กรุณาตอบคำถามให้ครบทุกข้อก่อนตรวจคำตอบ!");
        return;
      }
      score = checkAnswers();
      $("#quizBox").hide();
      $("#answerBox").show();
      displayAnswers(score);
    });

    $("#btnRetry").click(function(){
      $("#answerBox").hide();
      $("#startBox").show();
      $("#scoreDisplay").addClass('d-none');
    });

    function displayQuizList(){
      $("#quizListBox").empty();
      quizlist.forEach((q, i) => {
        displayQuiz(i, q);
      });
    }

    function displayQuiz(index, question){
      let no = index + 1;
      let html = `<div class='p-2'>
                    <strong>ข้อที่ ${no}:</strong> ${question.title}`;
      question.options.forEach((option, i) => {
        html += `<div class='form-check'>
                  <input class='form-check-input' type='radio' name='q${no}' value='${i + 1}' id='q${no}_${i + 1}'>
                  <label class='form-check-label' for='q${no}_${i + 1}'>
                    ${i + 1}. ${option}
                  </label>
                </div>`;
      });
      html += "</div>";
      $("#quizListBox").append(html);
    }

    function areAllQuestionsAnswered() {
      let allAnswered = true;
      quizlist.forEach((q, i) => {
        if (!$(`input[name='q${i + 1}']:checked`).val()) {
          allAnswered = false;
        }
      });
      return allAnswered;
    }

    function checkAnswers(){
      let score = 0;
      quizlist.forEach((q, i) => {
        let selected = $(`input[name='q${i + 1}']:checked`).val();
        if (parseInt(selected) === q.answer) {
          score++;
        }
      });
      return score;
    }

    function displayAnswers(score){
      $("#scoreDisplay").removeClass('d-none').text(`คะแนน: ${score}/${quizlist.length}`);
      let html = `คุณได้คะแนน ${score} จาก ${quizlist.length} ข้อ<br>`;
      html += quizlist.map((q, i) => {
        return `<div>
                  <strong>ข้อที่ ${i + 1}:</strong> ${q.title}<br>
                  คำตอบที่ถูกต้อง: ${q.answer}. ${q.options[q.answer - 1]}
                </div>`;
      }).join("<hr>");
      $("#answerContent").html(html);
    }

    const quizlist = [
      {
        "title": "ลำธารไหลผ่านหมู่บ้านแห่งหนึ่ง...",
        "options": [
          "ประชากร",
          "แหล่งที่อยู่",
          "ชีวภูมิภาค",
          "ระบบนิเวศ",
          "กลุ่มสิ่งมีชีวิต"
        ],
        "answer": 4
      },
      {
        "title": "10+15=?",
        "options": ["15", "20", "25", "30", "35"],
        "answer": 3
      }
    ];
  });
</script>
</body>
</html>
